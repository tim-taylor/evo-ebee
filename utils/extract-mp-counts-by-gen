#!/bin/bash
#
# Simple utility to extract flower marker point counts
# from an output log file generated by evobee when used
# with log-flag 'm' (FlowerMPsInterPhaseSummary)
#
# The numgens parameter specifies the number of generations
# to report. The output will cover all generations from
# 0 up to numgens-1.
#
# Outputs one CSV file for each reported generation. Each
# file contains a count of plants of each marker point
# present at that generation.

if [ "$#" -ne "2" ]; then
    echo "usage: extract-mp-counts-by-gen numgens logfile"
    exit
fi

NUMGENS=$1
LOGFILE=$2
INC=1
NGM1=$((NUMGENS - 1))

for G in `seq 0 $INC $NGM1`
do
  gawk -F',' -vG=$G '($1=="m" && $2==G) {print $4 "," $5}' $LOGFILE > mp-counts-gen-$G.csv
done
