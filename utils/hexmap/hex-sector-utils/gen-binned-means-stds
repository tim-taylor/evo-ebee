#!/bin/bash
#
# Script to generate datafiles suitable for plotting by plot-hex-sector-bins.gnuplot
#
# One output file is created for each generation in the range specified by
# GEN_START, GEN_END, GEN_DELTA
#
# The format of the generated output files is:
#     BIN, NUM_RUNS_OF_DATA, MEAN_NUM_FLOWERS_IN_BIN_ACROSS_RUNS, POP_STD_DEV
#
# The input files are the files generated by the script gen-hex-plot-data-across-runs.xxx

GEN_START=0
GEN_END=249
GEN_DELTA=5
INFILE_BASE="binned-numflowers-across-runs"
OUTFILE_BASE="binned-numflowers-across-runs-means-stds"
NUM_BINS=36
BIN_WIDTH=10

for G in `seq $GEN_START $GEN_DELTA $GEN_END`; do
    rm -f $OUTFILE_BASE-w$BIN_WIDTH-gen-$G.csv
    for B in `seq 0 $(( NUM_BINS - 1 ))`; do
        gawk -vB=$B '
BEGIN {
    FS=",";
    CNT=0;
    SUM=0;
    SD=0;
    y=0;
}

{
    CNT++;
    SUM+=$1;
    ARY[CNT]=$1;
}

END {
    if (CNT==0) {
        printf("%d, %d, %.4f, %.4f\n",B,0,0,0);
    }
    else {
        AVG=SUM/CNT;
        for (i in ARY) {
            y += (ARY[i]-AVG)^2;
        };
        if (CNT>1) {
            SD=sqrt(y/(CNT-1));
        }
        printf("%d, %d, %.4f, %.4f\n",B,CNT,(SUM/CNT),SD);
    }
}
        ' $INFILE_BASE-gen-$G-bin-$B.csv >> $OUTFILE_BASE-w$BIN_WIDTH-gen-$G.csv
    done
done
